# 기능 명세서

## 개요

조은이비인후과의원을 위한 진료 대기 관리 시스템입니다. 실시간으로 환자 대기 목록을 관리하고, 진료실별로 환자를 분류하여 효율적인 진료 운영을 지원합니다.

## 주요 기능

### 1. 환자 관리

#### 1.1 환자 접수

- **기능**: 새로운 환자를 대기 목록에 추가
- **입력**: 환자 이름
- **처리**:
  - 진료실 선택 (1진료실 또는 2진료실)
  - 자동으로 현재 시간을 등록 시간으로 기록
  - 기본 상태는 "대기"로 설정
- **출력**: 환자 카드가 해당 진료실 대기 목록에 추가됨

#### 1.2 환자 상태 변경

- **기능**: 환자의 진료 상태를 변경
- **상태 종류**:
  - 대기 (WAITING)
  - 진료 중 (EXAMINING)
  - 검사 후 대기 (EXAM_WAIT)
  - 완료 (COMPLETED)
  - 커스텀 상태 (사용자 정의)
- **처리**:
  - 드롭다운 메뉴에서 상태 선택 시 즉시 반영
  - 완료 상태로 변경 시 `completedAt` 필드에 현재 시간 자동 기록

#### 1.3 환자 삭제

- **기능**: 대기 목록에서 환자 제거
- **확인**: 삭제 전 확인 모달 표시
- **처리**: 환자 카드와 데이터베이스에서 완전히 제거

#### 1.4 환자 순서 변경 (드래그 앤 드롭)

- **기능**: 대기 순서를 드래그 앤 드롭으로 변경
- **제약**: 같은 진료실 내에서만 순서 변경 가능
- **처리**: 순서 변경 시 `order` 필드 자동 업데이트

### 2. 진료실 관리

#### 2.1 진료실별 환자 분류

- **기능**: 환자를 2개의 진료실로 분류
- **표시**: 각 진료실별로 독립적인 대기 목록 표시
- **정렬**: 대기 순서(`order`) 기준으로 정렬

#### 2.2 진료실 이름 설정

- **기능**: 진료실 이름을 사용자 정의
- **기본값**: "1진료실", "2진료실"
- **편집**: 관리자 모드에서 진료실 이름 클릭 시 편집 가능

#### 2.3 원장 이름 표시

- **기능**: 진료실 헤더에 원장 이름 표시
- **설정**: 환경 설정에서 표시 여부 선택 가능
- **편집**: 관리자 모드에서 원장 이름 클릭 시 편집 가능

#### 2.4 배너 광고 영역

- **기능**: 관리자 화면과 대기 화면 사이에 배너 광고 영역 표시
- **설정**: 환경 설정에서 표시 여부 선택 가능
- **표시 조건**: `showBanner` 설정이 `true`일 때만 표시
- **이미지 관리**:
  - 배너 이미지 업로드 (최대 5MB)
  - 배너 이미지 삭제
  - 자동 슬라이드 (3초 간격)
- **저장 방식**:
  - Base64 Data URL: 로컬스토리지에 저장된 이미지 (현재 구현)
  - 파일 크기 제한: 최대 5MB (로컬스토리지 용량 고려)

### 3. 상태 관리

#### 3.1 기본 상태

- **대기 (WAITING)**: 회색 배경, 기본 대기 상태
- **진료 중 (EXAMINING)**: 파란색 배경, 스테토스코프 아이콘, 강조 표시
- **검사 후 대기 (EXAM_WAIT)**: 주황색 배경
- **완료 (COMPLETED)**: 완료된 환자는 대기 목록에서 제외

#### 3.2 커스텀 상태 추가

- **기능**: 사용자 정의 상태 생성
- **설정 항목**:
  - 상태 이름 (라벨)
  - 색상 선택 (파랑, 초록, 주황, 빨강, 보라, 회색)
  - 자동으로 Tailwind CSS 클래스 생성
- **처리**: 상태 추가 시 즉시 환자 상태 선택 메뉴에 반영

#### 3.3 상태 편집 및 삭제

- **편집**: 상태 이름과 색상 변경 가능
- **삭제**: 상태 삭제 시 해당 상태를 사용 중인 환자는 "대기" 상태로 변경
- **순서 변경**: 드래그 앤 드롭으로 상태 순서 변경 가능

### 4. 안내 문구 관리

#### 4.1 안내 문구 추가

- **기능**: 진료 안내 문구를 추가
- **표시**: 화면 상단에 마퀴(marquee) 애니메이션으로 표시
- **처리**: 여러 개의 안내 문구를 순환 표시

#### 4.2 안내 문구 삭제

- **기능**: 불필요한 안내 문구 제거
- **처리**: 삭제 시 즉시 화면에서 제거

### 5. 배너 광고 관리

#### 5.1 배너 영역 표시 설정

- **기능**: 관리자 화면과 대기 화면에 배너 광고 영역 표시 여부 제어
- **설정**: 환경 설정 → 화면 표시 → 배너 광고 영역 표시
- **동작**:
  - `true`: 배너 영역 표시 (이미지가 없어도 영역은 표시됨)
  - `false`: 배너 영역 숨김

#### 5.2 배너 이미지 업로드

- **기능**: 배너 이미지를 업로드하여 슬라이드에 추가
- **제한사항**:
  - 이미지 파일만 업로드 가능 (JPG, PNG, GIF 등)
  - 파일 크기: 최대 5MB
- **저장 방식**:
  - Base64 Data URL: 로컬스토리지에 저장 (현재 구현)
  - 파일 크기 제한: 최대 5MB (로컬스토리지 용량 고려)
- **처리**: 업로드 시 즉시 배너 목록에 추가됨

#### 5.3 배너 이미지 삭제

- **기능**: 불필요한 배너 이미지 제거
- **확인**: 삭제 전 확인 모달 표시
- **처리**:
  - 로컬스토리지에서 이미지 삭제
  - 삭제 시 즉시 화면에서 제거

#### 5.4 배너 슬라이드

- **기능**: 여러 배너 이미지를 자동으로 슬라이드 표시
- **동작**:
  - 자동 슬라이드 간격: 3초
  - 마우스 호버 시 일시정지
  - 인디케이터로 현재 이미지 표시
  - 여러 이미지가 있을 경우 순환 표시

### 6. 화면 모드

#### 5.1 관리자 모드

- **기능**: 환자 관리 및 설정 변경 가능
- **표시 항목**:
  - 환자 추가 버튼
  - 환자 상태 변경 드롭다운
  - 환자 삭제 버튼
  - 드래그 앤 드롭 핸들
  - 설정 버튼
  - 저장 버튼
  - 완료된 환자 목록
- **기능**: 모든 관리 기능 사용 가능

#### 5.2 공개 모드

- **기능**: 환자 대기 목록만 표시 (읽기 전용)
- **표시 항목**:
  - 진료실별 환자 목록
  - 환자 이름 및 순위
  - 환자 상태 배지
  - 안내 문구
- **표시 방식**:
  - 상위 3명의 환자는 고정 표시
  - 4번째 환자부터는 순환 스크롤 애니메이션으로 표시
  - 완료된 환자는 표시되지 않음
- **제한**: 환자 추가, 수정, 삭제 불가

#### 5.3 모드 전환

- **기능**: 관리자 모드와 공개 모드 간 전환
- **경고**: 저장하지 않은 변경사항이 있으면 확인 모달 표시

### 7. 완료된 환자 관리

#### 6.1 완료된 환자 목록

- **기능**: 완료 상태인 환자들을 별도 목록으로 표시
- **표시 정보**:
  - 환자 이름
  - 진료실
  - 접수 시간 (`registeredAt`)
  - 완료 시간 (`completedAt`)
  - 소요 시간 (분 단위, 접수 시간과 완료 시간의 차이)
- **정렬**: 최신순으로 정렬 (완료 시간 기준)
- **데이터**: `completedAt` 필드가 없으면 접수 시간으로 추정하여 표시

#### 6.2 완료된 환자 삭제

- **기능**: 개별 또는 전체 삭제 가능
- **확인**: 전체 삭제 시 확인 모달 표시
- **처리**: 삭제 시 데이터베이스에서 완전히 제거

### 8. 실시간 동기화

#### 7.1 Firebase 연동

- **기능**: Firebase Realtime Database를 통한 실시간 데이터 동기화
- **처리**:
  - 여러 기기에서 동시 접속 시 변경사항 즉시 반영
  - 실시간 구독을 통한 자동 업데이트
- **설정**: 환경 설정에서 Firebase 연결 정보 입력

#### 7.2 데이터 저장

- **기능**: 모든 변경사항을 Firebase에 자동 저장
- **처리**:
  - 환자 추가/수정/삭제 시 즉시 Firebase에 저장
  - 설정 변경은 Draft 상태로 관리되며, 저장 버튼 클릭 시 Firebase에 저장
  - 저장 전 변경사항 추적 (`hasUnsavedChanges` 플래그)
  - 모드 전환 시 저장하지 않은 변경사항이 있으면 경고 표시

### 9. UI/UX 기능

#### 8.1 반응형 디자인

- **기능**: 모바일, 태블릿, 데스크톱 화면에 최적화
- **적응**: 화면 크기에 따라 레이아웃 자동 조정

#### 8.2 애니메이션

- **마퀴 애니메이션**: 안내 문구가 좌우로 흐르는 애니메이션
- **스크롤 애니메이션**: 공개 모드에서 4번째 환자부터 순환 스크롤
- **드래그 앤 드롭 피드백**: 드래그 시 시각적 피드백 제공
- **배너 슬라이드**: 배너 이미지 자동 슬라이드 (3초 간격, 마우스 호버 시 일시정지)

#### 8.3 환자 이름 자동 스크롤

- **기능**: 긴 이름이 컨테이너를 벗어날 경우 자동 스크롤
- **처리**: 이름 길이를 측정하여 필요 시에만 스크롤 적용

#### 8.4 전체화면 모드

- **기능**: 전체화면으로 전환하여 대형 화면에 표시
- **처리**: 헤더의 전체화면 버튼으로 전환

### 10. 알림 및 피드백

#### 9.1 토스트 알림

- **기능**: 작업 완료 시 화면 상단에 알림 표시
- **표시 시간**: 2.5초 후 자동 사라짐
- **메시지**: 저장 완료, 오류 발생 등

#### 9.2 확인 모달

- **기능**: 중요한 작업 전 확인 모달 표시
- **사용 사례**:
  - 환자 삭제
  - 완료된 환자 전체 삭제
  - 저장하지 않은 변경사항이 있을 때 모드 전환
- **변형**: 위험도에 따라 색상 변경 (기본, 경고, 위험)

### 11. 설정 관리

#### 10.1 환경 설정

- **기능**: 시스템 전반의 설정 관리
- **설정 항목**:
  - 진료실 이름
  - 원장 이름
  - 원장 이름 표시 여부
  - 배너 광고 영역 표시 여부
  - 안내 문구 목록
  - 커스텀 상태 목록
  - Firebase 연결 설정

#### 10.2 Firebase 설정

- **기능**: Firebase Realtime Database 연결 정보 입력
- **설정 방법**:
  1. 환경 설정 모달에서 Firebase 설정 섹션 접근
  2. Firebase 연결 정보 입력:
     - API Key (필수)
     - Auth Domain (필수)
     - Database URL (필수)
     - Project ID (필수)
     - Storage Bucket (선택)
     - Messaging Sender ID (선택)
     - App ID (선택)
  3. 저장 버튼 클릭
- **저장 위치**:
  - LocalStorage에 저장하여 다음 접속 시 자동 로드
  - Vercel 배포 시 환경 변수로도 설정 가능 (환경 변수가 우선)
- **초기화**: 설정 초기화 버튼으로 저장된 설정 삭제 가능

## 사용자 시나리오

### 시나리오 1: 환자 접수

1. 관리자 모드에서 진료실 선택
2. "환자 접수" 버튼 클릭
3. 환자 이름 입력
4. "등록" 버튼 클릭
5. 환자가 해당 진료실 대기 목록에 추가됨

### 시나리오 2: 진료 시작

1. 대기 목록에서 환자 선택
2. 상태 드롭다운에서 "진료 중" 선택
3. 환자 카드가 파란색으로 강조 표시됨
4. 공개 화면에서도 즉시 반영됨

### 시나리오 3: 진료 완료

1. 환자 상태를 "완료"로 변경
2. 환자가 대기 목록에서 사라짐
3. 완료된 환자 목록에 추가됨
4. 접수 시간, 완료 시간, 소요 시간이 기록됨

### 시나리오 4: 대기 순서 변경

1. 환자 카드를 드래그
2. 원하는 위치로 이동
3. 드롭하여 순서 변경
4. 순서가 즉시 반영됨

### 시나리오 5: 공개 화면 표시

1. 관리자 모드에서 "공개 모드"로 전환
2. 환자 관리 기능이 숨겨짐
3. 대기 목록만 표시됨
4. 대형 화면에 전체화면으로 표시 가능

### 시나리오 6: 배너 광고 관리

1. 관리자 모드에서 환경 설정 열기
2. 화면 표시 섹션에서 "배너 광고 영역 표시" 옵션 켜기
3. 배너 영역에 "이미지 추가" 버튼 클릭
4. 배너 이미지 파일 선택 및 업로드
5. 여러 이미지 업로드 시 자동 슬라이드로 표시
6. 불필요한 이미지는 삭제 버튼으로 제거
7. 설정 저장 후 대기 화면에도 배너 영역 표시됨

## 기술적 제약사항

1. **진료실 수**: 현재 2개 진료실만 지원
2. **동시 접속**: Firebase 무료 플랜 기준 100개 동시 연결
3. **데이터 저장**: Firebase Realtime Database 사용
4. **브라우저 지원**: 최신 브라우저 (Chrome, Firefox, Safari, Edge)

## 향후 개선 사항

- [ ] 환자 검색 기능
- [ ] 통계 및 리포트 기능
- [ ] 알림음 설정
- [ ] 다국어 지원
- [ ] 다크 모드 지원
- [ ] PWA 지원 (오프라인 모드)
- [ ] 인증 시스템 추가
